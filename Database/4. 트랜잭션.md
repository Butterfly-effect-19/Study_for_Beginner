# 트랜잭션

## 트랜잭션이란?

 트랜잭션은 **하나의 작업을 수행하기 위해 필요한 데이터베이스의 연산들을 모아놓은 것**으로, 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위이자 장애가 발생했을 때 데이터를 복구하는 작업의 단위입니다.

- 트랜잭션은 데이터베이스 시스템에서 **병행 제어 및 회복 작업** 시 처리 되는 작업의 논리적 단위
- 데이터베이스 연산은 SQL문으로 표현되므로 작업 수행에 필요한 **SQL문들의 모임**으로 이해해도 됨
- 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 **상태 변환 과정**의 작업 단위
- 하나의 트랜잭션은 **Commit**(모든 명령문이 완벽하게 처리)되거나 **Rollback**(하나도 처리되지 않음)됨

## 트랜잭션의 특성(ACID)

 트랜잭션이 성공적으로 처리되어 데이터베이스의 무결성과 일관성을 보장하려면 다음 4가지 특성을 만족해야 합니다.

- **원자성 (Atomicity)**
    - 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 함
    - 트랜잭션 내의 모든 명령은 반드시 완벽히 수행되어야 하며, 모두가 완벽히 수행되지 않고 어느 하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 함
- **일관성 (Consistency)**
    - 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변환함
    - 시스템이 가지고 있는 고정 요소는 트랜잭션 수행 전과 수행 완료 후의 상태가 같아야 함
- **독립성 (Isolation)**
    - 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없음
    - 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 참조될 수 없음
- **지속성 (Durability)**
    - 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 함

## 트랜잭션의 연산

 보통 데이터베이스를 사용할 때 쿼리를 날리면 데이터베이스에 반영이 된다고 생각하지만, **데이터베이스에 반영되는 시점은 트랜잭션 연산이 성공적으로 완료되는 시점**입니다. 이러한 트랜잭션 연산에는 크게 두가지가 있습니다.

### Commit 연산

- 트랜잭션이 성공적으로 수행되었음을 선언 (작업 완료)
- commit 연산이 실행된 후에야 트랜잭션의 수행 결과가 데이터베이스에 반영되어 데이터베이스가 일관된 상태를 지속적으로 유지 함

### Rollback 연산

- 트랜잭션 수행이 실패했음을 선언 (작업 취소)
- rollback 연산이 실행되면 트랜잭션이 지금까지 실행한 연산의 결과가 취소되고, 트랜잭션이 수행되기 전의 상태로 다시 돌아감

## 트랜잭션의 상태

 위와 같은 트랜잭션의 연산을 수행할 때, 크게 5가지의 상태가 존재합니다.

![transaction](https://github.com/Butterfly-effect-19/Study_for_Beginner/blob/main/image/transaction.png)

- **활동 (Active)**
    
     트랜잭션이 수행을 시작하여 현재 수행 중인 상태
    
- **실패 (Failed)**
    
    장애가 발생하여 트랜잭션의 수행이 중단된 상태
    
- **철회 (Aborted)**
    
    수행이 실패하여 rollback연산을 실행한 상태
    
- **부분 완료 (Partially Committed)**
    
    마지막 연산이 실행된 직후의 상태,
    
    연산은 모두 처리된 상태지만 수행한 최종 결과를 데이터베이스에 반영하지 않은 상태
    
- **완료 (Committed)**
    
    트랜잭션이 성공적으로 완료되어 commit연산을 실행한 상태
    

## 참고🔗

- [[DB기초] 트랜잭션이란 무엇인가?](https://coding-factory.tistory.com/226)
- [[DataBase] DB를 지탱하는 트랜잭션](https://brunch.co.kr/@skeks463/27)
- [트랜잭션(Transaction)이란](https://doooyeon.github.io/2018/09/28/transaction.html)
